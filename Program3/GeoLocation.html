<!DOCTYPE html>
<html>
<body>

<button onclick="getLocation()">Locate</button>
<p id="status"></p>
<canvas id="map" width="800" height="400"></canvas>

<script>
const canvas = document.getElementById("map");
const ctx = canvas.getContext("2d");
const statusText = document.getElementById("status");

const img = new Image();
img.src = "https://upload.wikimedia.org/wikipedia/commons/8/83/Equirectangular_projection_SW.jpg";
img.onload = () => ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

function getLocation() {
  if (!navigator.geolocation) return;
  statusText.textContent = "Locating...";
  navigator.geolocation.getCurrentPosition(draw, err);
}

function draw(pos) {
  const lat = pos.coords.latitude;
  const lon = pos.coords.longitude;
  statusText.textContent = `Lat: ${lat.toFixed(5)}, Lon: ${lon.toFixed(5)}`;

  const imgW = img.width, imgH = img.height;
  const x = (lon + 180) * (imgW / 360);
  const y = (90 - lat) * (imgH / 180);

  const zw = 200, zh = 100;
  const sx = Math.max(0, Math.min(imgW - zw, x - zw / 2));
  const sy = Math.max(0, Math.min(imgH - zh, y - zh / 2));

  ctx.drawImage(img, sx, sy, zw, zh, 0, 0, canvas.width, canvas.height);

  const zx = ((x - sx) / zw) * canvas.width;
  const zy = ((y - sy) / zh) * canvas.height;

  ctx.beginPath();
  ctx.arc(zx, zy, 6, 0, Math.PI * 2);
  ctx.fillStyle = "red";
  ctx.fill();
  ctx.fillStyle = "black";
  ctx.fillText("You", zx + 10, zy);
}

function err(e) {
  statusText.textContent = ["", "Denied", "Unavailable", "Timeout"][e.code] || "Error";
}
</script>

</body>
</html>