<!-- Demonstrate Geolocation and Canvas using HTML5 -->


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Geolocation on Canvas</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 30px;
    }
    canvas {
      border: 1px solid #ccc;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h2>My Location</h2>
  <p id="status">Click to locate</p>
  <button onclick="getLocation()">Locate</button><br>

  <canvas id="mapCanvas" width="800" height="400"></canvas>

  <script>
    const canvas = document.getElementById('mapCanvas');
    const ctx = canvas.getContext('2d');
    const statusText = document.getElementById('status');

    const mapImage = new Image();
    mapImage.src = "https://upload.wikimedia.org/wikipedia/commons/8/83/Equirectangular_projection_SW.jpg";

    mapImage.onload = () => {
      ctx.drawImage(mapImage, 0, 0, canvas.width, canvas.height);
    };

    function getLocation() {
      if (navigator.geolocation) {
        statusText.textContent = "Getting location...";
        navigator.geolocation.getCurrentPosition(drawZoomedLocation, showError);
      } else {
        statusText.textContent = "Geolocation is not supported.";
      }
    }

    function drawZoomedLocation(position) {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;
      statusText.innerHTML = `Latitude: ${lat.toFixed(6)}, Longitude: ${lon.toFixed(6)}`;

      // Convert lat/lon to map image pixel coordinates
      const imgWidth = mapImage.width;
      const imgHeight = mapImage.height;
      const x = (lon + 180) * (imgWidth / 360);
      const y = (90 - lat) * (imgHeight / 180);

      // Define zoom window size
      const zoomWidth = 200;
      const zoomHeight = 100;

      // Clamp to avoid cropping outside image edges
      const sx = Math.max(0, Math.min(imgWidth - zoomWidth, x - zoomWidth / 2));
      const sy = Math.max(0, Math.min(imgHeight - zoomHeight, y - zoomHeight / 2));

      // Draw zoomed portion
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(mapImage, sx, sy, zoomWidth, zoomHeight, 0, 0, canvas.width, canvas.height);

      // Calculate user's dot position in zoomed canvas
      const zoomedX = ((x - sx) / zoomWidth) * canvas.width;
      const zoomedY = ((y - sy) / zoomHeight) * canvas.height;

      // Draw location marker
      ctx.beginPath();
      ctx.arc(zoomedX, zoomedY, 6, 0, 2 * Math.PI);
      ctx.fillStyle = "red";
      ctx.fill();

      ctx.font = "16px Arial";
      ctx.fillStyle = "black";
      ctx.fillText("You are here", zoomedX + 10, zoomedY);
    }

    function showError(error) {
      const messages = {
        1: "Permission denied.",
        2: "Position unavailable.",
        3: "Request timed out."
      };
      statusText.textContent = messages[error.code] || "Unknown error.";
    }
  </script>
</body>
</html>
